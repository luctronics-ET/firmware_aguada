# Dashboard UI - Cisterna Ilha do Engenho
## Design Compacto para Monitoramento em Tempo Real

### ğŸ“Š Layout Proposto

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Cisterna Ilha do Engenho - Monitoramento Tempo Real                 â•‘
â•‘  Atualizado: 17/12/2025 14:23:45                                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
â•‘  â”‚ CIE1 â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘ 72%â”‚          â”‚ CIE2 â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘ 68%â”‚              â•‘
â•‘  â”‚ 176/245 mÂ³         â”‚          â”‚ 167/245 mÂ³         â”‚              â•‘
â•‘  â”‚ â†‘ 20mÂ³ â†“ 100mÂ³    â”‚          â”‚ â†‘ 15mÂ³ â†“ 95mÂ³     â”‚              â•‘
â•‘  â”‚ ğŸŸ¢ 14:23 | âš¡ -45dBmâ”‚          â”‚ ğŸŸ¢ 14:23 | âš¡ -48dBmâ”‚              â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â•‘
â•‘                                                                       â•‘
â•‘  Total: 343/490 mÂ³ (70%) | Dia: â†‘35mÂ³ â†“195mÂ³ | Saldo: -160mÂ³       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### ğŸ¨ VersÃ£o com Status Visual (Cores)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸŒŠ Cisterna Ilha do Engenho                      ğŸ”„ Atualizado: 14:23 â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                       â•‘
â•‘  â”Œâ”€â”€â”€â”€ CIE1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€ CIE2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â•‘
â•‘  â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘ 72%  â”‚    â”‚ â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 68%  â”‚  [verde: >50%]   â•‘
â•‘  â”‚ 176mÂ³ / 245mÂ³      â”‚    â”‚ 167mÂ³ / 245mÂ³      â”‚  [amarelo: 20-50%]â•‘
â•‘  â”‚                    â”‚    â”‚                    â”‚  [vermelho: <20%] â•‘
â•‘  â”‚ â†—ï¸ 20mÂ³  â†˜ï¸ 100mÂ³    â”‚    â”‚ â†—ï¸ 15mÂ³  â†˜ï¸ 95mÂ³     â”‚                   â•‘
â•‘  â”‚ ğŸŸ¢ 14:23  -45dBm   â”‚    â”‚ ğŸŸ¢ 14:22  -48dBm   â”‚                   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â•‘
â•‘                                                                       â•‘
â•‘  ğŸ“Š Resumo: 343mÂ³/490mÂ³ (70%)  |  ğŸ’§ Hoje: +35mÂ³ -195mÂ³ = -160mÂ³    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### ğŸš¨ Card com Alerta (Exemplo)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â”Œâ”€â”€â”€â”€ CIE1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€ CIE2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â•‘
â•‘  â”‚ ğŸš¨ ALERTA!         â”‚    â”‚ â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 68%  â”‚                   â•‘
â•‘  â”‚ â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 15%  â”‚    â”‚ 167mÂ³ / 245mÂ³      â”‚                   â•‘
â•‘  â”‚ 37mÂ³ / 245mÂ³       â”‚    â”‚                    â”‚                   â•‘
â•‘  â”‚                    â”‚    â”‚ â†—ï¸ 15mÂ³  â†˜ï¸ 95mÂ³     â”‚                   â•‘
â•‘  â”‚ â†—ï¸ 5mÂ³  â†˜ï¸ 120mÂ³     â”‚    â”‚ ğŸŸ¢ 14:22  -48dBm   â”‚                   â•‘
â•‘  â”‚ ğŸ”´ 14:20  -42dBm   â”‚    â”‚                    â”‚                   â•‘
â•‘  â”‚ âš ï¸ Vazamento!      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### ğŸ’¤ Card Offline (Sensor nÃ£o responde)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â”Œâ”€â”€â”€â”€ CIE1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€ CIE2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â•‘
â•‘  â”‚ â–’â–’â–’â–’â–’â–’â–’â–’â–‘â–‘â–‘â–‘â–‘ 72%  â”‚    â”‚ â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 68%  â”‚  [â–’ = offline]   â•‘
â•‘  â”‚ 176mÂ³ / 245mÂ³      â”‚    â”‚ 167mÂ³ / 245mÂ³      â”‚  [â–“ = online]    â•‘
â•‘  â”‚                    â”‚    â”‚                    â”‚                   â•‘
â•‘  â”‚ â†—ï¸ --  â†˜ï¸ --        â”‚    â”‚ â†—ï¸ 15mÂ³  â†˜ï¸ 95mÂ³     â”‚                   â•‘
â•‘  â”‚ âš« 12:05  -45dBm   â”‚    â”‚ ğŸŸ¢ 14:22  -48dBm   â”‚                   â•‘
â•‘  â”‚ ğŸ”Œ Offline 2h18min â”‚    â”‚                    â”‚                   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“ EspecificaÃ§Ãµes TÃ©cnicas do Card

### Estrutura do Card (Compacto)

```
â”Œâ”€â”€â”€â”€ [NOME] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [BARGRAPH] [PCT%]    â”‚  Linha 1: Barra + Percentual
â”‚ [VOL]/[MAX] mÂ³       â”‚  Linha 2: Volume atual/mÃ¡ximo
â”‚                      â”‚  Linha 3: (espaÃ§o para respirar)
â”‚ â†—ï¸ [IN]mÂ³ â†˜ï¸ [OUT]mÂ³   â”‚  Linha 4: Entradas/SaÃ­das
â”‚ [ST] [TIME] [RSSI]   â”‚  Linha 5: Status + Hora + Sinal
â”‚ [ALERTA] (opcional)  â”‚  Linha 6: Mensagem de alerta
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DimensÃµes
- **Largura**: 22 caracteres
- **Altura**: 6-7 linhas (dependendo se tem alerta)
- **EspaÃ§amento**: 4 espaÃ§os entre cards

### Ãcones e SÃ­mbolos

| Elemento | SÃ­mbolo | Cor CSS | Significado |
|----------|---------|---------|-------------|
| **Abastecimento** | â†—ï¸ ou â¬†ï¸ | `#28a745` (verde) | Volume de entrada |
| **Consumo** | â†˜ï¸ ou â¬‡ï¸ | `#dc3545` (vermelho) | Volume de saÃ­da |
| **Online** | ğŸŸ¢ | `#28a745` | Ãšltima leitura < 5min |
| **Alerta** | ğŸŸ¡ | `#ffc107` | Ãšltima leitura 5-15min |
| **Offline** | ğŸ”´ ou âš« | `#6c757d` | Sem dados > 15min |
| **Sinal WiFi** | âš¡ | Gradiente | RSSI em dBm |
| **Alerta CrÃ­tico** | ğŸš¨ | `#dc3545` pulsante | Vazamento/InundaÃ§Ã£o |
| **ManutenÃ§Ã£o** | ğŸ”§ | `#17a2b8` | Sensor em manutenÃ§Ã£o |

### Bargraph (Barra de Progresso)

```
Preenchimento:
â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘  (â–“ = cheio, â–‘ = vazio)

Cores por nÃ­vel:
> 70%:  Verde   #28a745
50-70%: Azul    #17a2b8
30-50%: Amarelo #ffc107
< 30%:  Laranja #fd7e14
< 15%:  Vermelho #dc3545

Offline: Cinza translÃºcido #6c757d80 (50% opacidade)
```

### Estados do Card

#### 1. **Normal (Online)**
```css
background: white
border: 2px solid #28a745
box-shadow: 0 2px 4px rgba(0,0,0,0.1)
```

#### 2. **Alerta (Anomalia)**
```css
background: #fff3cd
border: 2px solid #ffc107
box-shadow: 0 0 10px rgba(255,193,7,0.5)
animation: pulse 2s infinite
```

#### 3. **CrÃ­tico (Vazamento)**
```css
background: #f8d7da
border: 3px solid #dc3545
box-shadow: 0 0 15px rgba(220,53,69,0.7)
animation: pulse-fast 1s infinite
```

#### 4. **Offline (Sem dados)**
```css
background: rgba(108,117,125,0.1)
border: 2px dashed #6c757d
opacity: 0.7
filter: grayscale(50%)
```

---

## ğŸ’» HTML/CSS Exemplo

### Estrutura HTML

```html
<div class="cistern-container">
    <div class="cistern-header">
        <h2>ğŸŒŠ Cisterna Ilha do Engenho</h2>
        <span class="last-update">ğŸ”„ 14:23:45</span>
    </div>
    
    <div class="reservoirs">
        <!-- CIE1 -->
        <div class="reservoir-card online" id="cie1">
            <div class="card-header">CIE1</div>
            
            <div class="progress-bar">
                <div class="progress-fill" style="width: 72%; background: #28a745;">
                    <span class="progress-text">72%</span>
                </div>
            </div>
            
            <div class="volume">176mÂ³ / 245mÂ³</div>
            
            <div class="flow">
                <span class="inflow">â†—ï¸ 20mÂ³</span>
                <span class="outflow">â†˜ï¸ 100mÂ³</span>
            </div>
            
            <div class="status-bar">
                <span class="status online">ğŸŸ¢</span>
                <span class="time">14:23</span>
                <span class="signal">âš¡ -45dBm</span>
            </div>
        </div>
        
        <!-- CIE2 -->
        <div class="reservoir-card online" id="cie2">
            <div class="card-header">CIE2</div>
            
            <div class="progress-bar">
                <div class="progress-fill" style="width: 68%; background: #28a745;">
                    <span class="progress-text">68%</span>
                </div>
            </div>
            
            <div class="volume">167mÂ³ / 245mÂ³</div>
            
            <div class="flow">
                <span class="inflow">â†—ï¸ 15mÂ³</span>
                <span class="outflow">â†˜ï¸ 95mÂ³</span>
            </div>
            
            <div class="status-bar">
                <span class="status online">ğŸŸ¢</span>
                <span class="time">14:22</span>
                <span class="signal">âš¡ -48dBm</span>
            </div>
        </div>
    </div>
    
    <div class="summary">
        ğŸ“Š Total: 343mÂ³/490mÂ³ (70%) | ğŸ’§ Hoje: â†—ï¸35mÂ³ â†˜ï¸195mÂ³ = -160mÂ³
    </div>
</div>
```

### CSS Compacto

```css
.cistern-container {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 600px;
    margin: 20px auto;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.cistern-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #dee2e6;
}

.cistern-header h2 {
    margin: 0;
    font-size: 18px;
}

.last-update {
    font-size: 12px;
    color: #6c757d;
}

.reservoirs {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.reservoir-card {
    flex: 1;
    padding: 12px;
    background: white;
    border-radius: 6px;
    border: 2px solid #28a745;
    min-height: 140px;
    transition: all 0.3s ease;
}

.reservoir-card.offline {
    background: rgba(108,117,125,0.1);
    border: 2px dashed #6c757d;
    opacity: 0.7;
}

.reservoir-card.alert {
    background: #fff3cd;
    border: 2px solid #ffc107;
    animation: pulse 2s infinite;
}

.reservoir-card.critical {
    background: #f8d7da;
    border: 3px solid #dc3545;
    animation: pulse-fast 1s infinite;
}

@keyframes pulse {
    0%, 100% { box-shadow: 0 0 10px rgba(255,193,7,0.3); }
    50% { box-shadow: 0 0 20px rgba(255,193,7,0.6); }
}

@keyframes pulse-fast {
    0%, 100% { box-shadow: 0 0 15px rgba(220,53,69,0.5); }
    50% { box-shadow: 0 0 25px rgba(220,53,69,0.9); }
}

.card-header {
    font-weight: bold;
    font-size: 14px;
    margin-bottom: 8px;
    text-align: center;
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 4px;
}

.progress-bar {
    width: 100%;
    height: 20px;
    background: #e9ecef;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 8px;
    position: relative;
}

.progress-fill {
    height: 100%;
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.progress-text {
    font-size: 11px;
    font-weight: bold;
    color: white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.volume {
    font-size: 13px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 8px;
}

.flow {
    display: flex;
    justify-content: space-around;
    font-size: 12px;
    margin-bottom: 8px;
}

.inflow {
    color: #28a745;
}

.outflow {
    color: #dc3545;
}

.status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 11px;
    padding-top: 6px;
    border-top: 1px solid #dee2e6;
}

.status {
    font-size: 14px;
}

.time {
    color: #6c757d;
}

.signal {
    color: #17a2b8;
}

.summary {
    text-align: center;
    padding: 10px;
    background: white;
    border-radius: 6px;
    font-size: 13px;
    border: 1px solid #dee2e6;
}
```

---

## ğŸ“± VersÃ£o Mobile Responsiva

```css
@media (max-width: 600px) {
    .reservoirs {
        flex-direction: column;
        gap: 15px;
    }
    
    .reservoir-card {
        min-height: auto;
    }
    
    .cistern-header h2 {
        font-size: 16px;
    }
    
    .summary {
        font-size: 11px;
    }
}
```

---

## ğŸ”§ Backend PHP - CÃ¡lculo de In/Out

```php
<?php
// Calcular abastecimento e consumo do dia (00:00 - 23:59)

function getDailyFlow($node_id, $date = null) {
    global $pdo;
    
    if ($date === null) {
        $date = date('Y-m-d');
    }
    
    $start_ts = strtotime($date . ' 00:00:00') * 1000;
    $end_ts = strtotime($date . ' 23:59:59') * 1000;
    
    // Obter todas as leituras do dia ordenadas
    $stmt = $pdo->prepare("
        SELECT volume_l, ts_ms
        FROM telemetry_processed
        WHERE node_id = ?
          AND ts_ms >= ?
          AND ts_ms <= ?
        ORDER BY ts_ms ASC
    ");
    $stmt->execute([$node_id, $start_ts, $end_ts]);
    $readings = $stmt->fetchAll(PDO::FETCH_ASSOC);
    
    if (count($readings) < 2) {
        return ['inflow' => 0, 'outflow' => 0, 'net' => 0];
    }
    
    $inflow = 0;  // Abastecimento (volume aumentou)
    $outflow = 0; // Consumo (volume diminuiu)
    
    for ($i = 1; $i < count($readings); $i++) {
        $delta = $readings[$i]['volume_l'] - $readings[$i-1]['volume_l'];
        
        if ($delta > 0) {
            $inflow += $delta;
        } else if ($delta < 0) {
            $outflow += abs($delta);
        }
    }
    
    return [
        'inflow' => round($inflow / 1000, 1),   // Converter para mÂ³
        'outflow' => round($outflow / 1000, 1), // Converter para mÂ³
        'net' => round(($inflow - $outflow) / 1000, 1)
    ];
}

// Determinar status do sensor (online/offline)
function getSensorStatus($node_id) {
    global $pdo;
    
    $stmt = $pdo->prepare("
        SELECT ts_ms, flags, alert_type, rssi
        FROM telemetry_processed
        WHERE node_id = ?
        ORDER BY ts_ms DESC
        LIMIT 1
    ");
    $stmt->execute([$node_id]);
    $last = $stmt->fetch(PDO::FETCH_ASSOC);
    
    if (!$last) {
        return ['status' => 'offline', 'offline_minutes' => 9999];
    }
    
    $now = time() * 1000;
    $elapsed_ms = $now - $last['ts_ms'];
    $elapsed_min = floor($elapsed_ms / 60000);
    
    if ($elapsed_min < 5) {
        $status = 'online';
    } else if ($elapsed_min < 15) {
        $status = 'warning';
    } else {
        $status = 'offline';
    }
    
    return [
        'status' => $status,
        'offline_minutes' => $elapsed_min,
        'last_ts' => $last['ts_ms'],
        'has_alert' => ($last['flags'] & 1) ? true : false,
        'alert_type' => $last['alert_type'],
        'rssi' => $last['rssi']
    ];
}

// API endpoint: /api/dashboard.php
header('Content-Type: application/json');

$node_ids = [4, 5]; // CIE1 e CIE2
$data = [];

foreach ($node_ids as $node_id) {
    $flow = getDailyFlow($node_id);
    $status = getSensorStatus($node_id);
    
    // Ãšltima leitura
    $stmt = $pdo->prepare("
        SELECT level_cm, percentual, volume_l, distance_cm
        FROM telemetry_processed
        WHERE node_id = ?
        ORDER BY ts_ms DESC
        LIMIT 1
    ");
    $stmt->execute([$node_id]);
    $current = $stmt->fetch(PDO::FETCH_ASSOC);
    
    $data["cie" . $node_id] = [
        'node_id' => $node_id,
        'volume_m3' => round($current['volume_l'] / 1000, 0),
        'max_m3' => 245,
        'percentual' => $current['percentual'],
        'level_cm' => $current['level_cm'],
        'inflow_m3' => $flow['inflow'],
        'outflow_m3' => $flow['outflow'],
        'net_m3' => $flow['net'],
        'status' => $status['status'],
        'offline_minutes' => $status['offline_minutes'],
        'last_time' => date('H:i', $status['last_ts'] / 1000),
        'has_alert' => $status['has_alert'],
        'alert_type' => $status['alert_type'],
        'rssi' => $status['rssi']
    ];
}

echo json_encode($data, JSON_PRETTY_PRINT);
?>
```

---

## ğŸ¯ JavaScript - AtualizaÃ§Ã£o DinÃ¢mica

```javascript
// dashboard.js

async function updateDashboard() {
    try {
        const response = await fetch('/api/dashboard.php');
        const data = await response.json();
        
        updateReservoir('cie1', data.cie4);
        updateReservoir('cie2', data.cie5);
        updateSummary(data);
        
    } catch (error) {
        console.error('Erro ao atualizar dashboard:', error);
    }
}

function updateReservoir(elementId, data) {
    const card = document.getElementById(elementId);
    
    // Atualizar barra de progresso
    const progressFill = card.querySelector('.progress-fill');
    progressFill.style.width = data.percentual + '%';
    progressFill.style.background = getColorByLevel(data.percentual);
    progressFill.querySelector('.progress-text').textContent = data.percentual + '%';
    
    // Atualizar volume
    card.querySelector('.volume').textContent = 
        `${data.volume_m3}mÂ³ / ${data.max_m3}mÂ³`;
    
    // Atualizar fluxo
    card.querySelector('.inflow').textContent = `â†—ï¸ ${data.inflow_m3}mÂ³`;
    card.querySelector('.outflow').textContent = `â†˜ï¸ ${data.outflow_m3}mÂ³`;
    
    // Atualizar status
    const statusIcon = card.querySelector('.status');
    const statusTime = card.querySelector('.time');
    const statusSignal = card.querySelector('.signal');
    
    if (data.status === 'online') {
        statusIcon.textContent = 'ğŸŸ¢';
        card.className = 'reservoir-card online';
    } else if (data.status === 'warning') {
        statusIcon.textContent = 'ğŸŸ¡';
        card.className = 'reservoir-card alert';
    } else {
        statusIcon.textContent = 'âš«';
        card.className = 'reservoir-card offline';
        statusTime.textContent = `Offline ${data.offline_minutes}min`;
    }
    
    if (data.has_alert) {
        card.className = 'reservoir-card critical';
    }
    
    statusTime.textContent = data.last_time;
    statusSignal.textContent = `âš¡ ${data.rssi}dBm`;
}

function getColorByLevel(percent) {
    if (percent >= 70) return '#28a745';  // Verde
    if (percent >= 50) return '#17a2b8';  // Azul
    if (percent >= 30) return '#ffc107';  // Amarelo
    if (percent >= 15) return '#fd7e14';  // Laranja
    return '#dc3545';  // Vermelho
}

function updateSummary(data) {
    const cie1 = data.cie4;
    const cie2 = data.cie5;
    
    const totalVolume = cie1.volume_m3 + cie2.volume_m3;
    const totalMax = cie1.max_m3 + cie2.max_m3;
    const totalPercent = Math.round((totalVolume / totalMax) * 100);
    
    const totalInflow = cie1.inflow_m3 + cie2.inflow_m3;
    const totalOutflow = cie1.outflow_m3 + cie2.outflow_m3;
    const totalNet = totalInflow - totalOutflow;
    
    document.querySelector('.summary').innerHTML = 
        `ğŸ“Š Total: ${totalVolume}mÂ³/${totalMax}mÂ³ (${totalPercent}%) | ` +
        `ğŸ’§ Hoje: â†—ï¸${totalInflow}mÂ³ â†˜ï¸${totalOutflow}mÂ³ = ${totalNet >= 0 ? '+' : ''}${totalNet}mÂ³`;
}

// Atualizar a cada 30 segundos
setInterval(updateDashboard, 30000);
updateDashboard(); // Primeira atualizaÃ§Ã£o imediata
```

---

## ğŸ“Š Resumo das Features

### âœ… Implementado no Design

- **Cards Compactos**: MÃ¡ximo de informaÃ§Ã£o em espaÃ§o mÃ­nimo
- **Bargraph Visual**: Barra de progresso colorida (â–“â–‘)
- **Ãcones Intuitivos**: â†—ï¸ abastecimento (verde), â†˜ï¸ consumo (vermelho)
- **Status Online/Offline**: ğŸŸ¢ ğŸŸ¡ âš« com tempo de Ãºltima leitura
- **Alertas Visuais**: AnimaÃ§Ãµes pulsantes para anomalias
- **RSSI**: Indicador de qualidade de sinal WiFi
- **Volume DiÃ¡rio**: CÃ¡lculo de in/out do dia (00:00-23:59)
- **Totalizador**: Soma dos 2 reservatÃ³rios + saldo lÃ­quido
- **Responsivo**: Layout adaptÃ¡vel para mobile

### ğŸ¯ LÃ³gica de Cores

- Verde (`#28a745`): NÃ­vel > 70% ou abastecimento
- Azul (`#17a2b8`): NÃ­vel 50-70%
- Amarelo (`#ffc107`): NÃ­vel 30-50% ou alerta
- Laranja (`#fd7e14`): NÃ­vel < 30%
- Vermelho (`#dc3545`): NÃ­vel < 15%, vazamento ou consumo
- Cinza (`#6c757d`): Offline ou sem dados

### ğŸš€ PrÃ³ximos Passos

1. Copiar HTML/CSS/JS para arquivos do backend
2. Ajustar endpoint `/api/dashboard.php`
3. Testar com dados reais do MySQL
4. Adicionar grÃ¡ficos histÃ³ricos (Chart.js)
5. Implementar notificaÃ§Ãµes push para alertas

Este design maximiza densidade de informaÃ§Ã£o sem poluiÃ§Ã£o visual! ğŸ¯âœ¨
